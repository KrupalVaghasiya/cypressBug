name: GitHub Actions Demo
on:
  schedule:
  - cron: "0 0 * * *"
  push:
    branches:
      - 'master'
  env: 
  CYPRESS_CACHE_FOLDER: cypress/cache

jobs:
 cypress-test:
  name: Run on windows
  runs-on: windows-latest
  steps: 
    - uses: actions/checkout@v2
    - name: Cache Node Modules
      id: cache-node-modules
      uses: actions/cache@v2
      with:
        path: node_modules
        key: node-modules-${{ hashFiles('package-lock.json') }}

    - name: Cache Cypress Binary
      id: cache-cypress-binary
      uses: actions/cache@v2
      with:
        path: cypress/cache
        key: cypress-binary-${{ hashFiles('package-lock.json') }}

    - name: Install Dependencies
      if: steps.cache-node-modules.outputs.cache-hit != 'true'

    - name: Install dependencies
      run: |
        npm install
        npm install --dev
        npm run record-test

    - name: Copy execution test screenshots
      run: |
        mkdir Reports
        cp -r cypress/screenshots Reports/screenshots
    
    - name: Merge test reports
      run: merge:reports

    - name: Generate HTML reports
      run: create:html:report
